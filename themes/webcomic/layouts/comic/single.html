{{ define "title" }}
<!-- This will override the default value set in baseof.html; i.e., "{{.Site.Title}}" in the original example-->
{{ .Title }} â€“ {{ .Site.Title }}
{{ end }}
{{ define "main" }}
<div class="page comic container">
	<div class="comic-nav_top">
		{{ partial "comic-nav.html" . }}
	</div>
	<header class="comic__header">
		<h1 class="comic__title">{{ .Title }}</h1>
	</header>

	{{ if or (isset .Params "comic_mobile") (isset .Params "comic_desktop")}}
		<picture class="comic__whole">
			<!-- TODO: Add Image processing to this for 1x, 2x, etc-->
			{{ if (isset .Params "comic_mobile") }}
				{{ $image := resources.Get .Params.comic_mobile}}
				{{ $image_1x := $image.Resize "767x" }}
					<source media="(max-width: 767px)" srcset="{{ $image.Permalink }} 2x, {{ $image_1x.Permalink }} 1x">
			{{ end }}
			{{ if (isset .Params "comic_desktop") }}
				{{ $image := resources.Get .Params.comic_desktop}}
				{{ $image_1x := $image.Resize "1200x" }}
				<source media="(min-width: 768px)" srcset="{{ $image.Permalink }} 2x, {{ $image_1x.Permalink }} 1x">
			{{ end }}
			{{ if (isset .Params "comic_mobile") }}
				{{ $image := resources.Get .Params.comic_mobile}}
				<img src="{{ $image.Permalink }}" alt="Comic for {{ .Title }}">
			{{ else}}
				{{ $image := resources.Get .Params.comic_desktop }}
				<img src="{{ $image.Permalink }}" alt="Comic for {{ .Title }}">
			{{ end }}

		</picture>
	{{ else }}
		{{ range .Params.comic.rows }}
			<div class="comic__row">
				{{ range .cols}}
					<div class="comic__panel">
						{{ $image := resources.Get .panel}}
						{{ $noRetina := print "x" (div $image.Height 2) }}
						{{ $image_1x := $image.Resize $noRetina }}
						{{ $image_mobile := $image.Resize "x500" }}
						{{ $image_mobile2x := $image.Resize "x1000" }}
						<picture>
							<source media="(max-width: 767px)" srcset="{{ $image_mobile2x.Permalink }} 2x, {{ $image_mobile.Permalink }} 1x">
							<source media="(min-width: 768px)" srcset="{{ $image.Permalink }} 2x, {{ $image_1x.Permalink }} 1x">
							<img src="{{ $image_mobile.Permalink }}" class="comic__img">
						</picture>
					</div>
				{{end}}
			</div>
		{{ end }}
	{{ end }}

	<div class="comic__content">
		{{ .Content }}
		<strong>Characters</strong>
		<ul class="list-unstyled">
		{{ range .Params.characters }}
				<li><a href="/characters/{{ . | urlize }}">{{ . }}</a></li>
		{{ end }}
		</ul>
	</div>
</div>

<script >
		if (/Mobi|Android/i.test(navigator.userAgent)) {
			window.onscroll = function() {
					if ((window.innerHeight + window.pageYOffset) >= document.body.offsetHeight) {
							document.getElementsByClassName('next')[0].click();
					}
			};
		} else {
			document.addEventListener('keydown', (event) => {
				const keyName = event.key;
				switch (keyName) {
					case "ArrowLeft":
						document.getElementsByClassName('prev')[0].click();
						return;
					case "ArrowRight":
						document.getElementsByClassName('next')[0].click();
						return;
					default:
						return;
				}
			});
		}
		</script>

{{end}}
