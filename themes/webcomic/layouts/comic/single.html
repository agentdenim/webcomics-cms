{{ define "title" }}
<!-- This will override the default value set in baseof.html; i.e., "{{.Site.Title}}" in the original example-->
{{ .Title }} â€“ {{ .Site.Title }}
{{ end }}
{{ define "main" }}
<div class="page comic container">
	<div class="comic-nav_top">
		{{ partial "comic-nav.html" . }}
	</div>
	<header class="comic__header">
		<h1 class="comic__title">{{ .Title }}</h1>
	</header>

	{{ if (isset .Params "comic_desktop")}}
		{{ $desktop := resources.Get .Params.comic_desktop}}
		<picture class="comic__whole">
			{{ if (isset .Params "comic_mobile") }}
				{{ $mobile := resources.Get .Params.comic_mobile}}
				{{ $mobile_1200x := $mobile.Resize "1200x" }}
				{{ $mobile_1000x := $mobile.Resize "1000x" }}
				{{ $mobile_600x := $mobile.Resize "600x" }}
				{{ $mobile_500x := $mobile.Resize "500x" }}
				<source 
					media="(max-width: 768px)"
					sizes="(max-width: 768px) 100vw, 1200px" 
					srcset="
						{{ $mobile_500x.Permalink }} 500w,
						{{ $mobile_600x.Permalink }} 600w,
						{{ $mobile_1000x.Permalink }} 1000w,
						{{ $mobile_1200x.Permalink }} 1200w"
					sizes="100vw"
					>
			{{ end }}
				{{ $desktop_2400x := $desktop.Resize "2400x" }}
				{{ $desktop_1200x := $desktop.Resize "1200x" }}
				{{ $desktop_1000x := $desktop.Resize "1000x" }}
				<source 
					{{if (isset .Params "comic_mobile") }}
						media="(min-width: 768px)"
					{{ end }}
					sizes="(max-width: 1200px) 100vw, 1200px" 
					srcset="
						{{ $desktop_1000x.Permalink }} 1000w,
						{{ $desktop_1200x.Permalink }} 1200w,
						{{ $desktop_2400x.Permalink }} 2400w"
					sizes="100vw"
					>
				<img
					src="{{ $desktop_1200x.Permalink }}"
					alt="Comic for {{ .Title }}">
		{{ else }}
		{{ range .Params.comic.rows }}
			<div class="comic__row">
				{{ range .cols}}
					<div class="comic__panel">
						{{ $image := resources.Get .panel}}
						{{ $noRetina := print "x" (div $image.Height 2) }}
						{{ $image_1x := $image.Resize $noRetina }}
						{{ $image_mobile := $image.Resize "x500" }}
						{{ $image_mobile2x := $image.Resize "x1000" }}
						<picture>
							<source media="(max-width: 767px)" srcset="{{ $image_mobile2x.Permalink }} 2x, {{ $image_mobile.Permalink }} 1x">
							<source media="(min-width: 768px)" srcset="{{ $image.Permalink }} 2x, {{ $image_1x.Permalink }} 1x">
							<img src="{{ $image_mobile.Permalink }}" class="comic__img">
						</picture>
					</div>
				{{end}}
			</div>
		{{ end }}
	{{ end }}

	<div class="comic__content">
		{{ .Content }}
		<strong>Characters</strong>
		<ul class="list-unstyled">
		{{ range .Params.characters }}
				<li><a href="/characters/{{ . | urlize }}">{{ . }}</a></li>
		{{ end }}
		</ul>
	</div>
</div>

<script >
		if (/Mobi|Android/i.test(navigator.userAgent)) {
			window.onscroll = function() {
					if ((window.innerHeight + window.pageYOffset) >= document.body.offsetHeight) {
							document.getElementsByClassName('next')[0].click();
					}
			};
		} else {
			document.addEventListener('keydown', (event) => {
				const keyName = event.key;
				switch (keyName) {
					case "ArrowLeft":
						document.getElementsByClassName('prev')[0].click();
						return;
					case "ArrowRight":
						document.getElementsByClassName('next')[0].click();
						return;
					default:
						return;
				}
			});
		}
		</script>

{{end}}
